<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: post/add-post.mjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: post/add-post.mjs</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { auth } from "../logout/authorize.mjs";
import { validateUrl } from "../validate/url.mjs";
import { validateLength } from "../validate/length.mjs";
let url = "https://api.noroff.dev/api/v1/social/posts";

/**
 *
 * @param {NodeList} postInput This is a nodelist of input in the post form.
 * @param {Element} postTitleError This is a html element that will display if validation is not successful.
 * @param {Element} postMediaError  This is a html element that will display if validation is not successful.
 * @param {Element} postError This is a html element that will display if validation is not successful.
 * @param {Element} postLoader This is a html element that will display if while the request is being process.
 * @param {String} postId Id of the post if it edited or null if it a new post.
 */
export function getBodyData(
  postInput,
  postTitleError,
  postMediaError,
  postError,
  postLoader,
  postId
) {
  /**
   * Check first if the request is to send a new post or to edit a post by checking if postId is true or false.
   */
  if (postId) {
    url = "https://api.noroff.dev/api/v1/social/posts/" + postId;
  }

  /**
   * Convert the nodelist to an array then return empty string if the value attribute is not true.
   */
  const inputArray = Array.prototype.slice.call(postInput).map((input) => {
    if (input.value) {
      return input.value;
    } else {
      return (input = "");
    }
  });
  // console.log(inputArray);
  /**
   * Destructured the inputArray.
   */
  const [title, body, tags, media] = inputArray;
  const tagsArray = tags.split(",");
  if (validateLength(title, 5) === true) {
    postTitleError.classList.replace("d-flex", "d-none");
    if (media) {
      if (validateUrl(media) === true) {
        const postData = {
          title: title,
          body: body,
          tags: tagsArray,
          media: media,
        };
        postMediaError.classList.replace("d-flex", "d-none");
        postLoader.classList.replace("d-none", "d-inline-block");
        addPost(postData, postError, postLoader, postId);
      } else {
        postMediaError.classList.replace("d-none", "d-flex");
      }
    } else {
      const postData = {
        title: title,
        body: body,
        tags: tagsArray,
        media: media,
      };
      postMediaError.classList.replace("d-flex", "d-none");
      postLoader.classList.replace("d-none", "d-inline-block");
      addPost(postData, postError, postLoader, postId);
    }
  } else {
    postTitleError.classList.replace("d-none", "d-flex");
  }
}

/**
 * This function sent an API "POST" request.
 * @param {object} postData The data of the body that will be sent to the "POST" request.
 * @param {Element} postError This is a html element where error will be display.
 * @param {Element} postLoader This is a html element that will be display while the request is still being processed.
 * @param {String} postId Id of the post if it edited or null if it a new post.
 */
function addPost(postData, postError, postLoader, postId) {
  let bodyData = "";
  if (postId) {
    bodyData = {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${auth}`,
      },
      body: JSON.stringify(postData),
    };
  } else {
    bodyData = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${auth}`,
      },
      body: JSON.stringify(postData),
    };
  }
  // console.log(url, bodyData);
  fetch(url, bodyData)
    .then((response) => {
      console.log(response);
      if (response.ok) {
        return response.json();
      }
    })
    .then((data) => {
      // console.log(data);
      if (data.id) {
        postLoader.classList.replace("d-inline-block", "d-none");
        if (postId) {
          postError.innerHTML = "Post Edited successfuly";
          setTimeout(() => {
            location.reload();
          }, 3000);
        } else {
          postError.innerHTML = "New post submitted successfuly";
          setTimeout(() => {
            location.reload();
          }, 3000);
        }
      }
    })
    .catch((error) => {
      postLoader.classList.replace("d-inline-block", "d-none");
      postError.innerHTML =
        "There was a problem when submitting your post. Try again or reload the page. " +
        error;
    });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addPost">addPost</a></li><li><a href="global.html#callingGetPost">callingGetPost</a></li><li><a href="global.html#clickButton">clickButton</a></li><li><a href="global.html#commentModal">commentModal</a></li><li><a href="global.html#countsLike">countsLike</a></li><li><a href="global.html#deleteEditParam">deleteEditParam</a></li><li><a href="global.html#deletePost">deletePost</a></li><li><a href="global.html#displayPost">displayPost</a></li><li><a href="global.html#editPost">editPost</a></li><li><a href="global.html#followButtons">followButtons</a></li><li><a href="global.html#followUser">followUser</a></li><li><a href="global.html#following">following</a></li><li><a href="global.html#getBodyData">getBodyData</a></li><li><a href="global.html#getComments">getComments</a></li><li><a href="global.html#getContact">getContact</a></li><li><a href="global.html#getFollowing">getFollowing</a></li><li><a href="global.html#getPost">getPost</a></li><li><a href="global.html#getPostDetails">getPostDetails</a></li><li><a href="global.html#getReply">getReply</a></li><li><a href="global.html#getRequest">getRequest</a></li><li><a href="global.html#getTag">getTag</a></li><li><a href="global.html#getUserInfo">getUserInfo</a></li><li><a href="global.html#goDelete">goDelete</a></li><li><a href="global.html#goLogin">goLogin</a></li><li><a href="global.html#goSearch">goSearch</a></li><li><a href="global.html#gotoedit">gotoedit</a></li><li><a href="global.html#hitLike">hitLike</a></li><li><a href="global.html#idSearch">idSearch</a></li><li><a href="global.html#isItLiked">isItLiked</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#openComment">openComment</a></li><li><a href="global.html#profileCard">profileCard</a></li><li><a href="global.html#saveLikedPost">saveLikedPost</a></li><li><a href="global.html#sendComment">sendComment</a></li><li><a href="global.html#sendPicture">sendPicture</a></li><li><a href="global.html#signUp">signUp</a></li><li><a href="global.html#submitRegistration">submitRegistration</a></li><li><a href="global.html#tagUserSearch">tagUserSearch</a></li><li><a href="global.html#tagsArray">tagsArray</a></li><li><a href="global.html#updateProfile">updateProfile</a></li><li><a href="global.html#userImage">userImage</a></li><li><a href="global.html#validateEmail">validateEmail</a></li><li><a href="global.html#validateLength">validateLength</a></li><li><a href="global.html#validateUrl">validateUrl</a></li><li><a href="global.html#validateUsername">validateUsername</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Mar 03 2023 11:53:38 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
